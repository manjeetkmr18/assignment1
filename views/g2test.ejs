<!DOCTYPE html>
<html lang="en">
<%- include('./layouts/header'); -%>

    <body>

        <%- include('./layouts/navbar'); -%>

            <head>
                <script src="https://code.jquery.com/jquery-3.6.0.min.js">
                </script>
            
            </head>

            <!-- Page Header-->
            <header class="masthead" style="background: url(assets/gtest.jpg);background-repeat: no-repeat;
            background-size: cover; background-position: bottom;">
                <div class="container position-relative px-4 px-lg-5">
                    <div class="row gx-4 gx-lg-5 justify-content-center">
                        <div class="col-md-10 col-lg-8 col-xl-7">
                            <div class="page-heading">
                                <h1>G2 Test</h1>
                                <span class="subheading">Book G2 Drive Test Here</span>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            <!-- Main Content-->
            <main class="mb-4">

                <div class="container g2form-container">

                    <form action="/g2test/saveuser" method="POST">
                        <p>Fill Personal Information</p>
                        <div class="form-group">
                            <label for="firstname">FirstName</label>
                            <input type="text" class="form-control" id="firstName" placeholder="First Name"
                                name="firstName">
                        </div>
                        <div class="form-group">
                            <label for="lastname">LastName</label>
                            <input type="text" class="form-control" id="lastName" placeholder="Last Name"
                                name="lastName">
                        </div>

                        <div class="form-group">
                            <label for="licNumber">License Number</label>
                            <input type="text" class="form-control" id="licNumber" placeholder="License Number"
                                name="licNumber">
                        </div>

                        <div class="form-group">
                            <label for="age">Age</label>
                            <input type="number" class="form-control" id="age" placeholder="Age" name="age">
                        </div>

                        <p>Car Details</p>
                        <div class="form-group">
                            <label for="carMake">Make</label>
                            <input type="text" id="carMake" class="form-control" placeholder="Car Make" name="carMake">
                        </div>
                        <div class="form-group">
                            <label for="carModel">Model</label>
                            <input type="text" id="carModel" class="form-control" placeholder="Car Model"
                                name="carModel">
                        </div>

                        <div class="form-group">
                            <label for="carYear">Year</label>
                            <input type="number" id="carYear" class="form-control" placeholder="Car Year"
                                name="carYear">
                        </div>
                        <div class="form-group">
                            <label for="plateNumber">Plate Number</label>
                            <input type="text" id="plateNumber" class="form-control" placeholder="Plate Number"
                                name="plateNumber">
                        </div>

                        <div class="form-group">
                            <label for="date">Date</label>
                            <input class="form-control" type="date" name="date" id="date" placeholder="Date"
                                onchange="showAvailableSlots()" />
                        </div>

                        <div class="form-group">
                            <label for="time">Time</label>
                            <div id="slots"></div>
                        </div>

                        <button type="submit" class="btn btn-primary" id="g2-send" onclick="updateslots">Send</button>
                    </form>

                </div>

            </main>


            <footer>
                <script>
                  function showAvailableSlots(){
                    var date = document.getElementById("date").value;
                    var getData = $.ajax({
                        type: "POST",
                        url: "/g2test/getslots",
                        data: {date: date},
                        success: function(data){
                            console.log(data);

                            for (var i = 0; i < data.length; i++) {

                                if(data[i].isTimeSlotAvailable == true){
                                           document.getElementById("slots").innerHTML +=
                                        "<input  type='button' class='btn btn-success m-2'  value=" +
                                        data[i].time +
                                        " id=" +
                                        data[i].time +
                                        " onclick=selectslot('" +
                                        data[i].time +
                                        "');>";
                                }
                                else{
                                      document.getElementById("slots").innerHTML += 
                                      "<input  type='button' class='btn btn-secondary m-2' disabled value=" +
                                        data[i].time +
                                        " id=" +
                                        data[i].time +
                                        " onclick=selectslot('" +
                                        data[i].time +
                                        "');>";
                                }
                        
                            }

                        }
                    })
                  }


                  function selectslot(time){
                    document.getElementById(time).classList.remove("btn-success");
                    document.getElementById(time).classList.add("btn-danger");
                    document.getElementById(time).disabled = true;
                    document.getElementById("g2-send").disabled = false;
                    updateslots(time);
                  }

                  function updateslots(time){
                    var date = document.getElementById("date").value;
                    var updateSlot = $.ajax({
                        type: "POST",
                        url: "/g2test/updateslots",
                        data: {date: date,
                                time: time},
                        success: function(data){
                            console.log(data);
                        }
                    })
                  }

                </script>
            </footer>

            <%- include('./layouts/scripts'); -%>
    </body>

</html>